### Variables
@baseUrl = http://localhost:8080
@contentType = application/json

### Register a new user
# Password "SecurePass123!" base64 encoded
POST {{baseUrl}}/api/user/register
Content-Type: {{contentType}}

{
  "username": "johndoe",
  "firstName": "John",
  "lastName": "Doe",
  "email": "john.doe@example.com",
  "password": "U2VjdXJlUGFzczEyMyE=",
  "role": "USER"
}

> {%
  client.test("Register successful", function () {
    client.assert(response.status === 201, "Response status is not 201");
    client.assert(response.body.accessToken, "No access token in response");
  });
  client.global.set("authToken", response.body.accessToken);
%}

### Register another user
# Password "AdminPass456!" base64 encoded
POST {{baseUrl}}/api/user/register
Content-Type: {{contentType}}

{
  "username": "janedoe",
  "firstName": "Jane",
  "lastName": "Doe",
  "email": "jane.doe@example.com",
  "password": "QWRtaW5QYXNzNDU2IQ==",
  "role": "ADMIN"
}

> {%
  client.test("Register successful", function () {
    client.assert(response.status === 201, "Response status is not 201");
  });
%}

### Login with first user
# Password "SecurePass123!" base64 encoded
POST {{baseUrl}}/api/user/login
Content-Type: {{contentType}}

{
  "username": "johndoe",
  "password": "U2VjdXJlUGFzczEyMyE="
}

> {%
  client.test("Login successful", function () {
    client.assert(response.status === 200, "Response status is not 200");
    client.assert(response.body.accessToken, "No access token in response");
  });
  client.global.set("authToken", response.body.accessToken);
%}

### Login with second user
# Password "AdminPass456!" base64 encoded
POST {{baseUrl}}/api/user/login
Content-Type: {{contentType}}

{
  "username": "janedoe",
  "password": "QWRtaW5QYXNzNDU2IQ=="
}

> {%
  client.test("Login successful", function () {
    client.assert(response.status === 200, "Response status is not 200");
    client.assert(response.body.accessToken, "No access token in response");
  });
  client.global.set("authToken", response.body.accessToken);
%}

### Test with invalid credentials (should fail)
POST {{baseUrl}}/api/user/login
Content-Type: {{contentType}}

{
  "username": "johndoe",
  "password": "V3JvbmdQYXNzd29yZA=="
}

> {%
  client.test("Login should fail", function () {
    client.assert(response.status === 401 || response.status === 403,
        "Expected authentication failure");
  });
%}

### Test duplicate username registration (should fail)
POST {{baseUrl}}/api/user/register
Content-Type: {{contentType}}

{
  "username": "johndoe",
  "firstName": "Another",
  "lastName": "User",
  "email": "another@example.com",
  "password": "VGVzdFBhc3N3b3JkMTIz",
  "role": "USER"
}

> {%
  client.test("Registration should fail with duplicate username", function () {
    client.assert(response.status === 409, "Expected conflict status");
  });
%}

### Test duplicate email registration (should fail)
POST {{baseUrl}}/api/user/register
Content-Type: {{contentType}}

{
  "username": "newusername",
  "firstName": "Another",
  "lastName": "User",
  "email": "john.doe@example.com",
  "password": "VGVzdFBhc3N3b3JkMTIz",
  "role": "USER"
}

> {%
  client.test("Registration should fail with duplicate email", function () {
    client.assert(response.status === 409, "Expected conflict status");
  });
%}

### Test with missing required fields (should fail)
POST {{baseUrl}}/api/user/register
Content-Type: {{contentType}}

{
  "username": "incomplete",
  "email": "incomplete@example.com"
}

> {%
  client.test("Registration should fail with missing fields", function () {
    client.assert(response.status === 400, "Expected bad request status");
  });
%}

###
# Note: To encode your own password to base64, use:
# echo -n "YourPassword" | base64
# Or in browser console: btoa("YourPassword")
#
# Decoded passwords used in this file:
# - U2VjdXJlUGFzczEyMyE= = "SecurePass123!"
# - QWRtaW5QYXNzNDU2IQ== = "AdminPass456!"
# - V3JvbmdQYXNzd29yZA== = "WrongPassword"
# - VGVzdFBhc3N3b3JkMTIz = "TestPassword123"
###

